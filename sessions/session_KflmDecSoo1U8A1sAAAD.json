[
  {
    "command": "sudo apt clean && sudo rm -rf /var/lib/apt/lists/* && sudo apt update && sudo apt upgrade -y",
    "explanation": "The original command is syntactically correct. When 'apt' commands fail without specific error output, it often indicates an issue with corrupted local package lists or a transient problem. This fix first clears the 'apt' cache ('sudo apt clean'), then removes all existing package list files ('sudo rm -rf /var/lib/apt/lists/*'). This forces 'apt update' to download fresh package lists from the repositories, ensuring a clean state before attempting the 'update' and 'upgrade' again. This resolves issues caused by corrupted local data.",
    "dangerous": false,
    "id": "a6f320c9-8fa3-49ed-b2c3-7fe0432ec0cc",
    "status": "error"
  },
  {
    "command": "sudo apt install -y apache2 mariadb-server libapache2-mod-php php8.1-gd php8.1-mysql php8.1-curl php8.1-intl php8.1-imagick php8.1-xml php8.1-zip php8.1-mbstring php8.1-gmp php8.1-bcmath php8.1-opcache php8.1-apcu",
    "explanation": "Install Apache web server, MariaDB database server, PHP 8.1, and all necessary PHP modules required for Nextcloud functionality and performance.",
    "dangerous": true,
    "id": "2908c07b-35d6-4606-b53a-1bf85e85a218",
    "status": "pending"
  },
  {
    "command": "sudo mysql_secure_installation",
    "explanation": "Run the MariaDB security script to improve the default security of the database server, including setting a root password, removing anonymous users, and disabling remote root login. This is an interactive step.",
    "dangerous": true,
    "id": "42a6bad1-bbe8-4bb7-8cc6-444b7394072d",
    "status": "pending"
  },
  {
    "command": "sudo mysql -u root -e \"CREATE DATABASE nextcloud CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci; CREATE USER 'nextclouduser'@'localhost' IDENTIFIED BY 'NextcloudDBpass123!'; GRANT ALL PRIVILEGES ON nextcloud.* TO 'nextclouduser'@'localhost'; FLUSH PRIVILEGES;\"",
    "explanation": "Create a new database named 'nextcloud' with UTF8MB4 character set, create a new user 'nextclouduser' with a strong password (replace 'NextcloudDBpass123!' with your desired password), and grant all privileges on the 'nextcloud' database to this user. This assumes no root password for MySQL is set, otherwise use `sudo mysql -u root -pYOUR_ROOT_PASSWORD`.",
    "dangerous": true,
    "id": "86d6c29b-d78c-4b64-af55-b6007170dd16",
    "status": "pending"
  },
  {
    "command": "wget https://download.nextcloud.com/server/releases/latest.zip",
    "explanation": "Download the latest stable release of Nextcloud from its official website.",
    "dangerous": false,
    "id": "9f3015be-62dd-45a2-934d-ee90a2776520",
    "status": "pending"
  },
  {
    "command": "sudo unzip latest.zip -d /var/www/html/",
    "explanation": "Extract the downloaded Nextcloud archive to the Apache web root directory.",
    "dangerous": false,
    "id": "da4c3b73-6e25-46c4-8be6-14fc00ede389",
    "status": "pending"
  },
  {
    "command": "sudo chown -R www-data:www-data /var/www/html/nextcloud",
    "explanation": "Change the ownership of the Nextcloud installation directory to the Apache user (www-data) to ensure the web server has proper read/write permissions.",
    "dangerous": true,
    "id": "285cb56f-cc98-4630-9224-17586b46f20d",
    "status": "pending"
  },
  {
    "command": "sudo find /var/www/html/nextcloud/ -type d -exec chmod 750 {} \\; && sudo find /var/www/html/nextcloud/ -type f -exec chmod 640 {} \\; && sudo chmod 750 /var/www/html/nextcloud/occ",
    "explanation": "Set appropriate file and directory permissions for Nextcloud, ensuring security while allowing the web server to function correctly. Directories get 750, files get 640, and the occ command-line tool gets 750.",
    "dangerous": true,
    "id": "fcde8d05-242f-41ee-8f53-2ca7c3cc4d08",
    "status": "pending"
  },
  {
    "command": "sudo bash -c 'cat << EOF > /etc/apache2/sites-available/nextcloud.conf\n<VirtualHost *:80>\n    ServerAdmin webmaster@localhost\n    DocumentRoot /var/www/html/nextcloud\n    ServerName your_domain_or_IP_address\n\n    <Directory /var/www/html/nextcloud/>\n        Require all granted\n        AllowOverride All\n        Options FollowSymlinks MultiViews\n    </Directory>\n\n    ErrorLog ${APACHE_LOG_DIR}/error.log\n    CustomLog ${APACHE_LOG_DIR}/access.log combined\n</VirtualHost>\nEOF'",
    "explanation": "Create a new Apache virtual host configuration file for Nextcloud. Replace 'your_domain_or_IP_address' with your server's actual domain name or IP address.",
    "dangerous": true,
    "id": "184f3266-4673-4406-acaf-03867baeb58c",
    "status": "pending"
  },
  {
    "command": "sudo a2ensite nextcloud.conf && sudo a2dissite 000-default.conf && sudo a2enmod rewrite dir env headers",
    "explanation": "Enable the newly created Nextcloud Apache site, disable the default Apache site, and enable necessary Apache modules (rewrite, dir, env, headers) for Nextcloud's proper operation.",
    "dangerous": true,
    "id": "f84bf58d-8aee-4df3-b645-e4f7bc9672b7",
    "status": "pending"
  },
  {
    "command": "sudo sed -i 's/memory_limit = 128M/memory_limit = 512M/' /etc/php/8.1/apache2/php.ini && sudo sed -i 's/upload_max_filesize = 2M/upload_max_filesize = 1024M/' /etc/php/8.1/apache2/php.ini && sudo sed -i 's/post_max_size = 8M/post_max_size = 1024M/' /etc/php/8.1/apache2/php.ini && sudo sed -i 's/max_execution_time = 30/max_execution_time = 360/' /etc/php/8.1/apache2/php.ini && sudo sed -i 's/;date.timezone =/date.timezone = UTC/' /etc/php/8.1/apache2/php.ini",
    "explanation": "Adjust various PHP configuration parameters in `php.ini` to meet Nextcloud's recommendations, including increasing memory limit, upload/post file size limits, execution time, and setting the timezone.",
    "dangerous": true,
    "id": "99dbc6c1-1ba1-48e3-ac6f-cd296245a629",
    "status": "pending"
  },
  {
    "command": "sudo systemctl restart apache2",
    "explanation": "Restart the Apache web server to apply all the new configurations and module changes.",
    "dangerous": true,
    "id": "5fc38a0f-f68a-47f3-9144-d1c192aa65f9",
    "status": "pending"
  },
  {
    "command": "rm latest.zip",
    "explanation": "Remove the downloaded Nextcloud zip file as it's no longer needed after extraction.",
    "dangerous": false,
    "id": "844013b5-2424-4ba5-8c88-b96422a8f44e",
    "status": "pending"
  }
]